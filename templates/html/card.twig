{% extends "html/base.twig" %}

{% block styles %}
    <link href="/css/card.css" rel="stylesheet">
{% endblock %}

{% block main %}
{% verbatim %}
<div id="app" v-cloak>
    <div class="card-page">
        <div class="iteration-reel">
            <a class="iteration-reel__iteration" href="/cards">&laquo; Back To All</a>
            <div v-for="i in iterations" :key="i.iterationId"
                :class="{
                    'iteration-reel__iteration': true,
                    'iteration-reel__iteration--current': i.iterationId === current.iterationId,
                    'iteration-reel__iteration--comparing': comparing !== null && i.iterationId === comparing.iterationId,
                }"
                @click="compare(i)"
            >
                {{ i.createdAt }}
            </div>
        </div>

        <div class="card-editor__iteration">
            <div class="card-editor__title card-editor__title--current">Current Version</div>

            <div class="card-editor">
                <div class="card-editor__line">
                    <input type="number" min="0" step="1" class="card-editor__cost"
                        v-model="current.cost" placeholder="Cost"
                    >

                    <input type="text" class="card-editor__name" v-model="current.name"
                        :maxlength="maxLengths.name" placeholder="Card Name"
                    >

                    <input type="number" min="1" step="1" class="card-editor__starting-life" v-if="showLifeBurden(current)"
                        v-model="current.startingLife" placeholder="Life"
                    >
                </div>

                <div class="card-editor__line card-editor__line--enflowable-burden">
                    <select v-model="current.enflowable"
                        :class="{
                            'card-editor__changed': current.enflowable !== original.enflowable,
                        }"
                    >
                        <option :value="null">???</option>
                        <option :value="true">Enflowable</option>
                        <option :value="false">Not Enflowable</option>
                    </select>

                    <input type="number" min="0" step="1" placeholder="Burden" class="card-editor__burden"
                        v-if="showLifeBurden(current)"
                        v-model="current.burden"
                        :class="{
                            'card-editor__burden': true,
                            'card-editor__changed': current.burden !== original.burden,
                        }"
                    >
                </div>

                <div class="card-editor__line">
                    <select v-model="current.affinityId"
                        :class="{
                            'card-editor__changed': current.affinityId !== original.affinityId,
                        }"
                    >
                        <option :value="null">[Affinity TBD]</option>
                        <option v-for="a in affinities" :key="a.id" :value="a.id">
                            {{ a.name }}
                        </option>
                    </select>
                </div>

                <div class="card-editor__line">
                    <select v-model="current.speedModifier"
                        :class="{
                            'card-editor__changed': current.speedModifier !== original.speedModifier,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="m in speedModifiers" :key="m.value" :value="m.value">
                            {{ m.name }}
                        </option>
                    </select>

                    <select v-model="current.zoneModifier"
                        :class="{
                            'card-editor__changed': current.zoneModifier !== original.zoneModifier,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="m in zoneModifiers" :key="m.value" :value="m.value">
                            {{ m.name }}
                        </option>
                    </select>

                    <select v-model="current.cardType"
                        :class="{
                            'card-editor__changed': current.cardType !== original.cardType,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="t in cardTypes" :key="t.value" :value="t.value">
                            {{ t.name }}
                        </option>
                    </select>
                </div>

                <div class="card-editor__line">
                    <textarea :maxlength="maxLengths.rulesText"
                        :class="{
                            'card-editor__rules-text': true,
                            'card-editor__changed': current.rulesText !== original.rulesText,
                        }"
                        v-model="current.rulesText"
                    ></textarea>
                </div>

                <div class="card-editor__line card-editor__line--attack-defense" v-if="showAttackDefense(current)">
                    <input type="number" step="1" placeholder="Atk"
                        :class="{
                            'card-editor__attack': true,
                            'card-editor__changed': current.attack !== original.attack,
                        }"
                        v-model="current.attack"
                    >
                    <input type="number" step="1" placeholder="Def"
                        :class="{
                            'card-editor__defense': true,
                            'card-editor__changed': current.defense !== original.defense,
                        }"
                        v-model="current.defense"
                    >
                </div>
            </div>

            <div class="card-editor__actions">
                <button type="button" class="card-editor__button" @click="save"
                    :disabled="loading"
                >Save</button>

                <button type="button" class="card-editor__button" @click="resetChanges"
                    :disabled="loading"
                >Reset Changes</button>
            </div>
        </div>

        <div class="card-editor__iteration" v-if="comparing !== null">
            <div class="card-editor__title card-editor__title--previous">Previous Version</div>

            <div class="card-editor">
                <div class="card-editor__line">
                    <input type="number" min="0" step="1" placeholder="Cost" disabled
                        v-model="comparing.cost"
                        :class="{
                            'card-editor__cost': true,
                            'card-editor__changed': current.cost !== comparing.cost,
                        }"
                    >

                    <input type="text" :maxlength="maxLengths.name" placeholder="Card Name" disabled
                        v-model="comparing.name"
                        :class="{
                            'card-editor__name': true,
                            'card-editor__changed': current.name !== comparing.name,
                        }"
                    >

                    <input type="number" min="1" step="1" placeholder="Life" disabled
                        v-if="showLifeBurden(comparing)"
                        v-model="comparing.startingLife"
                        :class="{
                            'card-editor__starting-life': true,
                            'card-editor__changed': current.startingLife !== comparing.startingLife,
                        }"
                    >
                </div>

                <div class="card-editor__line card-editor__line--enflowable-burden">
                    <select v-model="comparing.enflowable" disabled
                        :class="{
                            'card-editor__changed': current.enflowable !== comparing.enflowable,
                        }"
                    >
                        <option :value="null">???</option>
                        <option :value="true">Enflowable</option>
                        <option :value="false">Not Enflowable</option>
                    </select>

                    <input type="number" min="0" step="1" placeholder="Burden" disabled
                        v-if="showLifeBurden(comparing)"
                        v-model="comparing.burden"
                        :class="{
                            'card-editor__burden': true,
                            'card-editor__changed': current.burden !== comparing.burden,
                        }"
                    >
                </div>

                <div class="card-editor__line">
                    <select v-model="comparing.affinityId" disabled
                        :class="{
                            'card-editor__changed': current.affinityId !== comparing.affinityId,
                        }"
                    >
                        <option :value="null">[Affinity TBD]</option>
                        <option v-for="a in affinities" :key="a.id" :value="a.id">
                            {{ a.name }}
                        </option>
                    </select>
                </div>

                <div class="card-editor__line">
                    <select v-model="comparing.speedModifier" disabled
                        :class="{
                            'card-editor__changed': current.speedModifier !== comparing.speedModifier,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="m in speedModifiers" :key="m.value" :value="m.value">
                            {{ m.name }}
                        </option>
                    </select>

                    <select v-model="comparing.zoneModifier" disabled
                        :class="{
                            'card-editor__changed': current.zoneModifier !== comparing.zoneModifier,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="m in zoneModifiers" :key="m.value" :value="m.value">
                            {{ m.name }}
                        </option>
                    </select>

                    <select v-model="comparing.cardType" disabled
                        :class="{
                            'card-editor__changed': current.cardType !== comparing.cardType,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="t in cardTypes" :key="t.value" :value="t.value">
                            {{ t.name }}
                        </option>
                    </select>
                </div>

                <div class="card-editor__line">
                    <textarea :maxlength="maxLengths.rulesText" disabled
                        :class="{
                            'card-editor__rules-text': true,
                            'card-editor__changed': current.rulesText !== comparing.rulesText,
                        }"
                        v-model="comparing.rulesText"
                    ></textarea>
                </div>

                <div class="card-editor__line card-editor__line--attack-defense" v-if="showAttackDefense(comparing)">
                    <input type="number" step="1" placeholder="Atk" disabled
                        :class="{
                            'card-editor__attack': true,
                            'card-editor__changed': current.attack !== comparing.attack,
                        }"
                        v-model="comparing.attack"
                    >
                    <input type="number" step="1" placeholder="Def" disabled
                        :class="{
                            'card-editor__defense': true,
                            'card-editor__changed': current.defense !== comparing.defense,
                        }"
                        v-model="comparing.defense"
                    >
                </div>
            </div>

            <div class="card-editor__actions">
                <button type="button" class="card-editor__button" @click="copyComparingIntoCurrent"
                    :disabled="loading"
                >Copy into Current</button>

                <button type="button" class="card-editor__button" @click="setComparingAsCurrent"
                    :disabled="loading"
                >Set as Current</button>
            </div>
        </div>
    </div>
</div>
{% endverbatim %}
{% endblock %}

{% block scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.5.13/vue.global.prod.min.js"></script>

    <script type="module" src="/js/card.js"></script>
{% endblock %}
