{% extends "html/base-logged-in.twig" %}

{% block styles %}
    <link href="/css/card.css" rel="stylesheet">
{% endblock %}

{% block main %}
{% verbatim %}
<div id="app" v-cloak>
    <div class="card-page">
        <div class="iteration-reel">
            <a class="iteration-reel__iteration" href="/cards">&laquo; Back To All</a>
            <div v-for="i in iterations" :key="i.iterationId"
                :class="{
                    'iteration-reel__iteration': true,
                    'iteration-reel__iteration--current': i.iterationId === current.iterationId,
                    'iteration-reel__iteration--comparing': comparing !== null && i.iterationId === comparing.iterationId,
                }"
                @click="compare(i)"
            >
                <div>{{ i.createdAt }}</div>
                <div>{{ i.createdBy }}</div>
            </div>
        </div>

        <div class="card-editor__iteration">
            <div class="card-editor__title card-editor__title--current">Current Version</div>

            <div class="card-editor">
                <div class="card-editor__line">
                    <input type="number" min="0" step="1" placeholder="Cost"
                        v-model="current.cost"
                        :class="{
                            'card-editor__cost': true,
                            'card-editor__changed': changedOriginalCost,
                        }"
                    >

                    <input type="text" :maxlength="maxLengths.name" placeholder="Card Name"
                        v-model="current.name"
                        :class="{
                            'card-editor__name': true,
                            'card-editor__changed': changedOriginalName,
                        }"
                    >

                    <input type="number" min="1" step="1" placeholder="Life"
                        v-if="showLifeBurden(current)"
                        v-model="current.startingLife"
                        :class="{
                            'card-editor__starting-life': true,
                            'card-editor__changed': changedOriginalStartingLife,
                        }"
                    >
                </div>

                <div class="card-editor__line card-editor__line--enflowable-burden">
                    <select v-model="current.enflowable"
                        :class="{
                            'card-editor__changed': changedOriginalEnflowable,
                        }"
                    >
                        <option :value="null">???</option>
                        <option :value="true">Enflowable</option>
                        <option :value="false">Not Enflowable</option>
                    </select>

                    <input type="number" min="0" step="1" placeholder="Burden"
                        v-if="showLifeBurden(current)"
                        v-model="current.burden"
                        :class="{
                            'card-editor__burden': true,
                            'card-editor__changed': changedOriginalBurden,
                        }"
                    >
                </div>

                <div class="card-editor__line">
                    <select v-model="current.affinityId"
                        :class="{
                            'card-editor__changed': changedOriginalAffinity,
                        }"
                    >
                        <option :value="null">[Affinity TBD]</option>
                        <option v-for="a in affinities" :key="a.id" :value="a.id">
                            {{ a.name }}
                        </option>
                    </select>
                </div>

                <div class="card-editor__line">
                    <select v-model="current.speedModifier"
                        :class="{
                            'card-editor__changed': changedOriginalSpeedModifier,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="m in speedModifiers" :key="m.value" :value="m.value">
                            {{ m.name }}
                        </option>
                    </select>

                    <select v-model="current.zoneModifier"
                        :class="{
                            'card-editor__changed': changedOriginalZoneModifier,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="m in zoneModifiers" :key="m.value" :value="m.value">
                            {{ m.name }}
                        </option>
                    </select>

                    <select v-model="current.cardType"
                        :class="{
                            'card-editor__changed': changedOriginalCardType,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="t in cardTypes" :key="t.value" :value="t.value">
                            {{ t.name }}
                        </option>
                    </select>
                </div>

                <div class="card-editor__line">
                    <textarea :maxlength="maxLengths.rulesText"
                        :class="{
                            'card-editor__rules-text': true,
                            'card-editor__changed': changedOriginalRulesText,
                        }"
                        v-model="current.rulesText"
                    ></textarea>
                </div>

                <div class="card-editor__line card-editor__line--attack-defense" v-if="showAttackDefense(current)">
                    <input type="number" step="1" placeholder="Atk"
                        :class="{
                            'card-editor__attack': true,
                            'card-editor__changed': changedOriginalAttack,
                        }"
                        v-model="current.attack"
                    >
                    <input type="number" step="1" placeholder="Def"
                        :class="{
                            'card-editor__defense': true,
                            'card-editor__changed': changedOriginalDefense,
                        }"
                        v-model="current.defense"
                    >
                </div>
            </div>

            <div class="card-editor__actions">
                <button type="button" class="card-editor__button" @click="save"
                    :disabled="loading || !changedOriginal"
                >Save</button>

                <button type="button" class="card-editor__button" @click="resetChanges"
                    :disabled="loading || !changedOriginal"
                >Reset Changes</button>
            </div>
        </div>

        <div class="card-editor__iteration" v-if="comparing !== null">
            <div class="card-editor__title card-editor__title--comparing">Comparing Version</div>

            <div class="card-editor">
                <div class="card-editor__line">
                    <input type="number" min="0" step="1" placeholder="Cost" disabled
                        v-model="comparing.cost"
                        :class="{
                            'card-editor__cost': true,
                            'card-editor__changed': changedComparingCost,
                        }"
                    >

                    <input type="text" :maxlength="maxLengths.name" placeholder="Card Name" disabled
                        v-model="comparing.name"
                        :class="{
                            'card-editor__name': true,
                            'card-editor__changed': changedComparingName,
                        }"
                    >

                    <input type="number" min="1" step="1" placeholder="Life" disabled
                        v-if="showLifeBurden(comparing)"
                        v-model="comparing.startingLife"
                        :class="{
                            'card-editor__starting-life': true,
                            'card-editor__changed': changedComparingStartingLife,
                        }"
                    >
                </div>

                <div class="card-editor__line card-editor__line--enflowable-burden">
                    <select v-model="comparing.enflowable" disabled
                        :class="{
                            'card-editor__changed': changedComparingEnflowable,
                        }"
                    >
                        <option :value="null">???</option>
                        <option :value="true">Enflowable</option>
                        <option :value="false">Not Enflowable</option>
                    </select>

                    <input type="number" min="0" step="1" placeholder="Burden" disabled
                        v-if="showLifeBurden(comparing)"
                        v-model="comparing.burden"
                        :class="{
                            'card-editor__burden': true,
                            'card-editor__changed': changedComparingBurden,
                        }"
                    >
                </div>

                <div class="card-editor__line">
                    <select v-model="comparing.affinityId" disabled
                        :class="{
                            'card-editor__changed': changedComparingAffinity,
                        }"
                    >
                        <option :value="null">[Affinity TBD]</option>
                        <option v-for="a in affinities" :key="a.id" :value="a.id">
                            {{ a.name }}
                        </option>
                    </select>
                </div>

                <div class="card-editor__line">
                    <select v-model="comparing.speedModifier" disabled
                        :class="{
                            'card-editor__changed': changedComparingSpeedModifier,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="m in speedModifiers" :key="m.value" :value="m.value">
                            {{ m.name }}
                        </option>
                    </select>

                    <select v-model="comparing.zoneModifier" disabled
                        :class="{
                            'card-editor__changed': changedComparingZoneModifier,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="m in zoneModifiers" :key="m.value" :value="m.value">
                            {{ m.name }}
                        </option>
                    </select>

                    <select v-model="comparing.cardType" disabled
                        :class="{
                            'card-editor__changed': changedComparingCardType,
                        }"
                    >
                        <option :value="null">???</option>
                        <option v-for="t in cardTypes" :key="t.value" :value="t.value">
                            {{ t.name }}
                        </option>
                    </select>
                </div>

                <div class="card-editor__line">
                    <textarea :maxlength="maxLengths.rulesText" disabled
                        :class="{
                            'card-editor__rules-text': true,
                            'card-editor__changed': changedComparingRulesText,
                        }"
                        v-model="comparing.rulesText"
                    ></textarea>
                </div>

                <div class="card-editor__line card-editor__line--attack-defense" v-if="showAttackDefense(comparing)">
                    <input type="number" step="1" placeholder="Atk" disabled
                        :class="{
                            'card-editor__attack': true,
                            'card-editor__changed': changedComparingAttack,
                        }"
                        v-model="comparing.attack"
                    >
                    <input type="number" step="1" placeholder="Def" disabled
                        :class="{
                            'card-editor__defense': true,
                            'card-editor__changed': changedComparingDefense,
                        }"
                        v-model="comparing.defense"
                    >
                </div>
            </div>

            <div class="card-editor__actions">
                <button type="button" class="card-editor__button" @click="copyComparingIntoCurrent"
                    :disabled="loading"
                >Copy into Current</button>

                <button type="button" class="card-editor__button" @click="setComparingAsCurrent"
                    :disabled="loading"
                >Set as Current</button>
            </div>
        </div>
    </div>
</div>
{% endverbatim %}
{% endblock %}

{% block scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.5.13/vue.global.prod.min.js"></script>

    <script type="module" src="/js/card.js"></script>
{% endblock %}
